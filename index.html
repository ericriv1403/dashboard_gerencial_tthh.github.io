<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Formulario Muestreo</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="card">
    <h2>Registro de Muestreo (Google Sheets)</h2>
    <div class="muted">PIN · Bloques ACTIVO · Validaciones · Duplicados · Reemplazo con auditoría</div>

    <div id="statusTop" class="muted" style="margin-top:10px"></div>

    <div id="loginBox" style="margin-top:14px">
      <h3>1) Login</h3>
      <div class="grid2">
        <label>
          <div class="lbl">User ID</div>
          <input id="user_id" placeholder="m001">
        </label>
        <label>
          <div class="lbl">PIN</div>
          <input id="pin" placeholder="******" inputmode="numeric" type="password">
        </label>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnLogin">Ingresar</button>
        <div id="loginMsg" class="muted"></div>
      </div>
    </div>

    <div id="appBox" class="hidden" style="margin-top:14px">
      <div class="row" style="justify-content:space-between">
        <div class="row" style="gap:8px;flex-wrap:wrap">
          <span class="pill">Usuario: <b id="who"></b></span>
          <span class="pill">Rol: <b id="role"></b></span>
          <span class="pill">Fecha: <b id="fecha"></b></span>
        </div>
        <div class="row">
          <button class="ghost" id="btnReloadBlocks">Recargar bloques</button>
          <button class="ghost hidden" id="btnAdminToggle">Administración</button>
          <button class="ghost" id="btnLogout">Salir</button>
        </div>
      </div>

      <hr class="sep">

      <div class="grid2">
        <label>
          <div class="lbl">Bloque (solo ACTIVO)</div>
          <input id="bloque" list="dlBloques" placeholder="Escribe para buscar…">
          <datalist id="dlBloques"></datalist>
          <div class="muted" id="bloqueHint"></div>
        </label>

        <label>
          <div class="lbl">Modo</div>
          <select id="modo">
            <option value="ALTURA">ALTURA (solo altura)</option>
            <option value="COMPLETO">COMPLETO (altura + estructura + diámetro)</option>
          </select>
          <div class="muted" id="modoHint"></div>
        </label>
      </div>

      <div class="grid3" style="margin-top:10px">
        <label>
          <div class="lbl">N muestras (editable)</div>
          <input id="n" type="number" min="1" step="1">
          <div class="muted" id="nHint"></div>
        </label>
        <label>
          <div class="lbl">Observación general (opcional)</div>
          <input id="obs" placeholder="Ej: daño, anomalía…">
        </label>
        <div id="dupBox" class="warnBox hidden">
          <div><b style="color:var(--warn)">Advertencia de duplicado</b></div>
          <div id="dupText" class="muted" style="margin-top:6px"></div>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnBuild">Crear formulario</button>
        <button class="ghost" id="btnClear">Limpiar</button>
        <div id="msg" class="muted"></div>
      </div>

      <div id="tableArea"></div>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnSubmit" disabled>Enviar</button>
        <div id="submitMsg" class="muted"></div>
      </div>

      <div id="finalMsg" class="muted" style="margin-top:8px"></div>

      <div id="adminBox" class="hidden" style="margin-top:18px">
        <hr class="sep">
        <h3>Administración (ADMIN)</h3>
        <div class="muted">
          1) Buscar sesiones vigentes de HOY (is_current=TRUE) por bloque y modo.<br>
          2) Cargar una sesión para editar (se prellenará el formulario).<br>
          3) Enviar → reemplaza: viejas a FALSE y nuevas a TRUE (auditoría).
        </div>

        <div class="grid2" style="margin-top:10px">
          <label>
            <div class="lbl">Bloque</div>
            <input id="admBloque" list="dlBloques" placeholder="Bloque…">
          </label>
          <label>
            <div class="lbl">Modo</div>
            <select id="admModo">
              <option value="ALTURA">ALTURA</option>
              <option value="COMPLETO">COMPLETO</option>
            </select>
          </label>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnFindSessions">Listar sesiones HOY</button>
          <div id="admMsg" class="muted"></div>
        </div>

        <div id="sessionsList"></div>
        <div id="replaceHint" class="muted" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <script src="./config.js"></script>
  <script src="./app.js"></script>
</body>
</html>
